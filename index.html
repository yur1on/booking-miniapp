<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>–ó–∞–ø–∏—Å—å</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <style>
    :root{
      --bg:#0b1220;
      --text:rgba(255,255,255,.92);
      --hint:rgba(255,255,255,.62);
      --border:rgba(255,255,255,.12);
      --card:rgba(255,255,255,.06);
      --radius:16px;
      --radius2:14px;
      --shadow:0 10px 26px rgba(0,0,0,.22);
      --tap:46px;
      --gap:10px;
      --pad:14px;
    }
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
      background: var(--tg-theme-bg-color, var(--bg));
      color: var(--tg-theme-text-color, var(--text));
    }
    .wrap{
      max-width:520px;
      margin:0 auto;
      padding:
        calc(var(--pad) + env(safe-area-inset-top))
        var(--pad)
        calc(var(--pad) + env(safe-area-inset-bottom));
    }
    .hero{
      border:1px solid color-mix(in srgb, var(--tg-theme-hint-color, #999) 28%, transparent);
      background: linear-gradient(
        135deg,
        color-mix(in srgb, var(--tg-theme-button-color, #4f46e5) 22%, transparent),
        color-mix(in srgb, var(--tg-theme-link-color, #6ee7ff) 12%, transparent)
      );
      border-radius:var(--radius);
      padding:14px;
      box-shadow:var(--shadow);
      display:flex;
      justify-content:space-between;
      gap:10px;
    }
    .title{margin:0;font-weight:900;font-size:18px;line-height:1.2;}
    .subtitle{margin:6px 0 0 0;font-size:13px;color:var(--tg-theme-hint-color,var(--hint));line-height:1.35;}
    .pill{
      border:1px solid color-mix(in srgb, var(--tg-theme-hint-color, #999) 28%, transparent);
      background: color-mix(in srgb, var(--tg-theme-bg-color, #000) 82%, transparent);
      border-radius:999px;
      padding:8px 10px;
      font-size:12px;
      color: var(--tg-theme-hint-color, var(--hint));
      white-space:nowrap;
      height: fit-content;
    }
    .card{
      margin-top:var(--gap);
      border:1px solid color-mix(in srgb, var(--tg-theme-hint-color, #999) 28%, transparent);
      background: color-mix(in srgb, var(--tg-theme-bg-color, var(--bg)) 86%, white 14%);
      border-radius:var(--radius);
      padding:14px;
      box-shadow:var(--shadow);
    }
    .head{
      display:flex;
      justify-content:space-between;
      align-items:baseline;
      gap:10px;
      margin-bottom:10px;
    }
    .h{margin:0;font-weight:900;font-size:14px;}
    .hint{margin:0;font-size:12px;color:var(--tg-theme-hint-color,var(--hint));text-align:right;}

    .services{display:grid; grid-template-columns:1fr; gap:10px;}
    .svc{
      border-radius:var(--radius2);
      border:1px solid color-mix(in srgb, var(--tg-theme-hint-color, #999) 28%, transparent);
      background: color-mix(in srgb, var(--tg-theme-bg-color, var(--bg)) 90%, white 10%);
      padding:12px;
      min-height:74px;
      cursor:pointer;
      user-select:none;
      display:flex;
      flex-direction:column;
      justify-content:space-between;
      gap:8px;
    }
    .svc.active{
      border-color: color-mix(in srgb, var(--tg-theme-button-color, #4f46e5) 70%, white 30%);
      background: linear-gradient(
        135deg,
        color-mix(in srgb, var(--tg-theme-button-color, #4f46e5) 16%, transparent),
        color-mix(in srgb, var(--tg-theme-link-color, #6ee7ff) 10%, transparent)
      );
    }
    .svc-top{display:flex; justify-content:space-between; gap:10px; align-items:flex-start;}
    .svc-name{margin:0;font-weight:900;font-size:13px;line-height:1.2;}
    .svc-price{margin:0;font-weight:950;font-size:13px;color:var(--tg-theme-link-color,#6ee7ff);white-space:nowrap;}
    .svc-meta{margin:0;font-size:12px;color:var(--tg-theme-hint-color,var(--hint));}

    .dates{
      display:grid;
      gap:10px;
      grid-template-columns: repeat(4, minmax(0,1fr));
    }
    @media (max-width: 360px){
      .dates{ grid-template-columns: repeat(3, minmax(0,1fr)); }
    }
    .date{
      height:58px;
      border-radius:14px;
      border:1px solid color-mix(in srgb, var(--tg-theme-hint-color, #999) 28%, transparent);
      background: color-mix(in srgb, var(--tg-theme-bg-color, var(--bg)) 90%, white 10%);
      cursor:pointer;
      user-select:none;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:2px;
      text-align:center;
    }
    .date.active{
      border-color: color-mix(in srgb, var(--tg-theme-button-color, #4f46e5) 70%, white 30%);
      background: linear-gradient(
        135deg,
        color-mix(in srgb, var(--tg-theme-button-color, #4f46e5) 16%, transparent),
        color-mix(in srgb, var(--tg-theme-link-color, #6ee7ff) 10%, transparent)
      );
    }
    .d1{margin:0;font-weight:950;font-size:13px;}
    .d2{margin:0;font-size:11px;color:var(--tg-theme-hint-color,var(--hint));}

    .note{
      margin:10px 0 0 0;
      font-size:12px;
      color:var(--tg-theme-hint-color,var(--hint));
      line-height:1.35;
    }
    .btn{
      margin-top:12px;
      width:100%;
      height: var(--tap);
      border-radius: 14px;
      border: 0;
      font-weight: 900;
      font-size: 14px;
      cursor: pointer;
      color: var(--tg-theme-button-text-color, #fff);
      background: var(--tg-theme-button-color, #4f46e5);
    }
    .btn:disabled{
      opacity:.55;
      cursor:not-allowed;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="hero">
      <div>
        <p class="title" id="hello">–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶</p>
        <p class="subtitle">–í—ã–±–µ—Ä–∏—Ç–µ —É—Å–ª—É–≥—É –∏ –¥–∞—Ç—É. –°–≤–æ–±–æ–¥–Ω–æ–µ –≤—Ä–µ–º—è –±–æ—Ç –ø—Ä–∏—à–ª—ë—Ç –∫–Ω–æ–ø–∫–∞–º–∏ –≤ —á–∞—Ç.</p>
      </div>
      <div class="pill">Mini App</div>
    </div>

    <div class="card">
      <div class="head">
        <p class="h">–£—Å–ª—É–≥–∞</p>
        <p class="hint">–≤—ã–±–µ—Ä–∏—Ç–µ –æ–¥–Ω—É</p>
      </div>
      <div class="services" id="services"></div>
    </div>

    <div class="card">
      <div class="head">
        <p class="h">–î–∞—Ç–∞</p>
        <p class="hint">12 –¥–Ω–µ–π –≤–ø–µ—Ä—ë–¥</p>
      </div>
      <div class="dates" id="dates"></div>

      <button class="btn" id="send" disabled>üì® –ü–æ–∫–∞–∑–∞—Ç—å —Å–≤–æ–±–æ–¥–Ω—ã–µ —Å–ª–æ—Ç—ã</button>

      <p class="note">
        –ü–æ—á–µ–º—É —Ç–∞–∫: –ª–æ–∫–∞–ª—å–Ω–æ –±–µ–∑ API Mini App –Ω–µ –º–æ–∂–µ—Ç —É–∑–Ω–∞—Ç—å –∑–∞–Ω—è—Ç–æ—Å—Ç—å –∏–∑ –±–∞–∑—ã.
        –ü–æ—ç—Ç–æ–º—É –±–æ—Ç –ø–æ—Å—á–∏—Ç–∞–µ—Ç —Å–≤–æ–±–æ–¥–Ω—ã–µ —Å–ª–æ—Ç—ã –∏ –ø—Ä–∏—à–ª—ë—Ç –∏—Ö –≤ —á–∞—Ç.
      </p>
    </div>
  </div>

  <script>
    const tg = window.Telegram?.WebApp;
    if (tg) { tg.ready(); tg.expand(); }

    // –í—Ä–µ–º–µ–Ω–Ω–æ —Å—Ç–∞—Ç–∏–∫–æ–π (–ø–æ–∑–∂–µ –º–æ–∂–Ω–æ —Ç—è–Ω—É—Ç—å –∏–∑ Django —á–µ—Ä–µ–∑ API)
    const SERVICES = [
      { id: 1, name: "–ù–∞—Ä–∞—â–∏–≤–∞–Ω–∏–µ –∫–ª–∞—Å—Å–∏–∫–∞", price: 40, durationMin: 120 },
      { id: 2, name: "2D/3D", price: 55, durationMin: 150 },
      { id: 3, name: "–ö–æ—Ä—Ä–µ–∫—Ü–∏—è", price: 30, durationMin: 90 },
      { id: 4, name: "–°–Ω—è—Ç–∏–µ", price: 15, durationMin: 30 },
    ];

    const DAYS_AHEAD = 12;

    let selectedService = null;
    let selectedDateISO = null;

    function pad2(n){ return String(n).padStart(2,"0"); }
    function toISODate(d){ return `${d.getFullYear()}-${pad2(d.getMonth()+1)}-${pad2(d.getDate())}`; }
    function formatDateChip(iso){
      const d = new Date(iso + "T00:00:00");
      const dd = pad2(d.getDate());
      const mm = pad2(d.getMonth()+1);
      const wd = ["–í—Å","–ü–Ω","–í—Ç","–°—Ä","–ß—Ç","–ü—Ç","–°–±"][d.getDay()];
      return { top: `${dd}.${mm}`, bottom: wd };
    }

    function updateButton(){
      const btn = document.getElementById("send");
      btn.disabled = !(selectedService && selectedDateISO);
    }

    function renderServices(){
      const wrap = document.getElementById("services");
      wrap.innerHTML = "";
      SERVICES.forEach(s => {
        const div = document.createElement("div");
        div.className = "svc" + (selectedService?.id === s.id ? " active" : "");
        div.innerHTML = `
          <div class="svc-top">
            <p class="svc-name">${s.name}</p>
            <p class="svc-price">${s.price} BYN</p>
          </div>
          <p class="svc-meta">‚è± ${s.durationMin} –º–∏–Ω</p>
        `;
        div.onclick = () => {
          selectedService = s;
          renderServices();
          updateButton();
        };
        wrap.appendChild(div);
      });
    }

    function renderDates(){
      const wrap = document.getElementById("dates");
      wrap.innerHTML = "";

      const today = new Date();
      for (let i=0; i<DAYS_AHEAD; i++){
        const d = new Date(today.getFullYear(), today.getMonth(), today.getDate() + i);
        const iso = toISODate(d);
        const {top, bottom} = formatDateChip(iso);

        const chip = document.createElement("div");
        chip.className = "date" + (selectedDateISO === iso ? " active" : "");
        chip.innerHTML = `
          <p class="d1">${top}</p>
          <p class="d2">${bottom}</p>
        `;
        chip.onclick = () => {
          selectedDateISO = iso;
          renderDates();
          updateButton();
        };
        wrap.appendChild(chip);
      }

      if (!selectedDateISO) selectedDateISO = toISODate(new Date());
    }

    function init(){
      const hello = document.getElementById("hello");
      if (tg){
        const u = tg.initDataUnsafe?.user;
        hello.textContent = u ? `–ü—Ä–∏–≤–µ—Ç, ${u.first_name}!` : "–ü—Ä–∏–≤–µ—Ç!";
      } else {
        hello.textContent = "–û—Ç–∫—Ä–æ–π—Ç–µ —á–µ—Ä–µ–∑ Telegram";
      }

      selectedService = SERVICES[0];
      renderServices();
      renderDates();
      updateButton();

      document.getElementById("send").onclick = () => {
        if (!tg) return;

        const payload = {
          action: "get_slots",
          service_id: selectedService.id,
          date: selectedDateISO
        };

        tg.sendData(JSON.stringify(payload));
        tg.close();
      };
    }

    init();
  </script>
</body>
</html>
